<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kreat√∂rsbank ‚Äì Avelle Media</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
  <div class="max-w-6xl mx-auto bg-white p-6 rounded-lg shadow">
    <h1 class="text-2xl font-bold mb-2">UGC Kreat√∂rsbank</h1>
    <p id="statusMessage" class="text-sm mb-6 text-gray-600">‚è≥ Laddar kreat√∂rsdata...</p>

    <!-- Filtersektion -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
      <select id="genderFilter" class="border p-2 rounded">
        <option value="">Filtrera p√• k√∂n</option>
      </select>
      <select id="ageFilter" class="border p-2 rounded">
        <option value="">Filtrera p√• √•lder</option>
        <option value="under 25">Under 25</option>
        <option value="25-35">25-35</option>
        <option value="√∂ver 35">√ñver 35</option>
      </select>
      <select id="contentFilter" class="border p-2 rounded">
        <option value="">Filtrera p√• content-typ</option>
      </select>
    </div>

    <!-- Tabell -->
    <table class="min-w-full bg-white border">
      <thead>
        <tr class="bg-gray-200">
          <th class="border p-2">Namn</th>
          <th class="border p-2">Instagram</th>
          <th class="border p-2">K√∂n</th>
          <th class="border p-2">√Ölder</th>
          <th class="border p-2">Content-typer</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>

    <!-- Detaljvy -->
    <div id="detailView" class="mt-8 p-4 bg-gray-50 border rounded hidden">
      <h2 class="text-xl font-semibold mb-4">Detaljerad info</h2>
      <div id="detailContent" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
    </div>
  </div>

  <script>
    const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS1EY4K0ysQf2sTwLBy2jn28CTW6x6M8REzvX8PBphsn7tzdHjhYPfN3S_kYmAXwzoEM_iuzCCUWSBi/pub?gid=157980788&single=true&output=csv";
    let data = [];

    function loadSheet() {
      fetch(SHEET_URL)
        .then(response => response.text())
        .then(csvText => {
          Papa.parse(csvText, {
            header: true,
            skipEmptyLines: true,
            complete: function(results) {
              data = results.data.map(row => ({
                f√∂rnamn: row["First name"] || '',
                efternamn: row["Last name"] || '',
                email: row["Email"] || '',
                k√∂n: row["Ange ditt k√∂n."] || '',
                √•lder: parseInt(row["√Ölder"]) || 0,
                instagram: row["Vad heter du p√• Instagram\\"] || '',
                tiktok: row["Vad heter du p√• Tiktok\\"] || '',
                content: row["üé•‚ÄØVilken typ av content tycker du allra mest om att skapa"] || '',
                spr√•k: row["Spr√•k du talar flytande"] || '',
                telefon: row["Vad √§r ditt telefonnummer\\"] || '',
                selfie: row["üì• Ladda upp en selfie!"] || '',
                hemsida: row["Har du en hemsida eller en portf√∂lj\\"] || '',
                video: row["Skicka en kort video/UGC video n√§r du pratar"] || '',
                dialekt: row["Har du n√•gon dialekt"] || '',
                city: row["City/Town"] || '',
                address: row["Address"] || '',
              }));

              document.getElementById("statusMessage").textContent = "‚úîÔ∏è Data inl√§st fr√•n Google Sheet";
              document.getElementById("statusMessage").classList.add("text-green-600");
              populateFilters(data);
              renderTable(data);
            }
          });
        })
        .catch(error => {
          console.error("Fel vid h√§mtning:", error);
          const msg = document.getElementById("statusMessage");
          msg.textContent = "‚ùå Kunde inte h√§mta data fr√•n Google Sheet.";
          msg.classList.add("text-red-600");
        });
    }

    function populateFilters(data) {
      const genderSet = new Set();
      const contentSet = new Set();

      data.forEach(row => {
        if (row.k√∂n) genderSet.add(row.k√∂n.trim());
        if (row.content) {
          row.content.split(',').forEach(c => contentSet.add(c.trim()));
        }
      });

      const genderFilter = document.getElementById("genderFilter");
      genderSet.forEach(gender => {
        const opt = document.createElement("option");
        opt.value = gender;
        opt.textContent = gender;
        genderFilter.appendChild(opt);
      });

      const contentFilter = document.getElementById("contentFilter");
      contentSet.forEach(content => {
        const opt = document.createElement("option");
        opt.value = content;
        opt.textContent = content;
        contentFilter.appendChild(opt);
      });
    }

    function renderTable(filteredData) {
      const tableBody = document.getElementById("tableBody");
      tableBody.innerHTML = "";

      filteredData.forEach(row => {
        const tr = document.createElement("tr");
        tr.classList.add("cursor-pointer", "hover:bg-gray-100");
        tr.innerHTML = `
          <td class="border p-2">${row.f√∂rnamn} ${row.efternamn}</td>
          <td class="border p-2">${row.instagram}</td>
          <td class="border p-2">${row.k√∂n}</td>
          <td class="border p-2">${row.√•lder}</td>
          <td class="border p-2">${row.content}</td>
        `;
        tr.addEventListener("click", () => showDetails(row));
        tableBody.appendChild(tr);
      });
    }

    function filterData() {
      const gender = document.getElementById("genderFilter").value;
      const ageCat = document.getElementById("ageFilter").value;
      const content = document.getElementById("contentFilter").value;

      const filtered = data.filter(row => {
        const matchGender = !gender || row.k√∂n === gender;
        const matchContent = !content || row.content.toLowerCase().includes(content.toLowerCase());
        let matchAge = true;
        if (ageCat === "under 25") matchAge = row.√•lder < 25;
        else if (ageCat === "25-35") matchAge = row.√•lder >= 25 && row.√•lder <= 35;
        else if (ageCat === "√∂ver 35") matchAge = row.√•lder > 35;
        return matchGender && matchAge && matchContent;
      });

      renderTable(filtered);
    }

    function showDetails(row) {
      const detail = document.getElementById("detailView");
      const content = document.getElementById("detailContent");
      detail.classList.remove("hidden");
      content.innerHTML = "";

      for (const [key, value] of Object.entries(row)) {
        const div = document.createElement("div");
        div.innerHTML = `<strong>${key}:</strong> ${value || '-'}`;
        content.appendChild(div);
      }
    }

    document.getElementById("genderFilter").addEventListener("change", filterData);
    document.getElementById("ageFilter").addEventListener("change", filterData);
    document.getElementById("contentFilter").addEventListener("change", filterData);

    window.addEventListener("DOMContentLoaded", loadSheet);
  </script>
</body>
</html>

